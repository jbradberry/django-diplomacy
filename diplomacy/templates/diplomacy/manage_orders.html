<html>
  <head>
    <link rel="stylesheet" href="/diplomacy/media/css/orders.css"
      type="text/css">
    <script type="text/javascript"
    src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js">
    </script>
    <script type="text/javascript">
      $(document).ready(function() {
	$("col").each(function() { $(this).width( $(this).width() ); });
	
        $("select[name$='u_type']").change(function() {

          var u_type = $(this).find("option:selected").val();
          var grandparent = $(this).parent().parent();
          grandparent.find("select[name$='actor'] > optgroup"
          ).each(function() {
            if ( this.label != u_type ) { $(this).hide(); }
            else { $(this).show(); }
          });

        }).trigger("change");
      
        $("select[name$='action']").change(function() {
      
          var act = $(this).find("option:selected").val();
          var grandparent = $(this).parent().parent();
          var target = grandparent.find("select[name$='target']");
          var dest = grandparent.find("select[name$='destination']");

          target.find("optgroup").each(function() {
            if ( this.label != act ) { $(this).hide(); }
            else {
              $(this).show();
              $(this).find("option:first").attr("selected", "selected");
            }
          });
          var T = target.find("optgroup[label='" +act+ "'] option");
          if ( T.length == 1 && T[0].value == "" ) { target.fadeOut("def"); }
	  else { target.fadeIn("def"); }

          dest.find("optgroup").each(function() {
            if ( this.label != act ) { $(this).hide(); }
            else {
              $(this).show();
              $(this).find("option:first").attr("selected", "selected");
            }
          });
          var D = dest.find("optgroup[label='" +act+ "'] option");
          if ( D.length == 1 && D[0].value == "" ) { dest.fadeOut("def"); }
	  else { dest.fadeIn("def"); }
	
        }).trigger("change");
      });
    </script>
  </head>
  <body>
    <form method="POST" action="">
      {{ formset.management_form }}
      {{ formset.non_form_errors.as_ul }}
      <table id="formset" class="form">
	{% for form in formset.forms %}
	{% if forloop.first %}
	{% for field in form.visible_fields %}
	<col id="{{ field.name }}">
	{% endfor %}
	<thead>
	  <tr>
	    {% for field in form.visible_fields %}
	    <th>{{ field.label|capfirst }}</th>
	    {% endfor %}
	  </tr>
	</thead>
	{% endif %}
	<tr class="{% cycle row1,row2 %}">
	  {% for field in form.visible_fields %}
	  <td>
	    {% if forloop.first %}
	    {% for hidden in form.hidden_fields %}
	    {{ hidden }}
	    {% endfor %}
	    {% endif %}
	    {{ field.errors.as_ul }}
	    {{ field }}
	  </td>
	  {% endfor %}
	</tr>
	{% endfor %}
      </table>
      <input type="submit" value="Submit" />
    </form>
  </body>
</html>
