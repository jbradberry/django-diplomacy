<html>
  <head>
    <script type="text/javascript"
    src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js">
    </script>
    <script type="text/javascript">
      $(document).ready(function() {
        $("select[name$='u_type']").change(function() {

          var u_type = $(this).find("option:selected").val();
          var grandparent = $(this).parent().parent();
          grandparent.find("select[name$='actor'] > optgroup"
          ).each(function() {
            if ( this.label != u_type ) { $(this).hide(); }
            else { $(this).show(); }
          });

        }).trigger("change");
      
        $("select[name$='action']").change(function() {
      
          var act = $(this).find("option:selected").val();
          var grandparent = $(this).parent().parent();
          grandparent.find("select[name$='target'] > optgroup"
          ).each(function() {
            if ( this.label != act ) { $(this).hide(); }
            else { $(this).show(); }
          });
          grandparent.find("select[name$='destination'] > optgroup"
          ).each(function() {
            if ( this.label != act ) { $(this).hide(); }
            else { $(this).show(); }
          });
      
        }).trigger("change");
      });
    </script>
  </head>
  <body>
    <form method="POST" action="">
      {{ formset.management_form }}
      {{ formset.non_form_errors.as_ul }}
      <table id="formset" class="form">
	{% for form in formset.forms %}
	{% if forloop.first %}
	<thead>
	  <tr>
	    {% for field in form.visible_fields %}
	    <th>{{ field.label|capfirst }}</th>
	    {% endfor %}
	  </tr>
	</thead>
	{% endif %}
	<tr class="{% cycle row1,row2 %}">
	  {% for field in form.visible_fields %}
	  <td>
	    {% if forloop.first %}
	    {% for hidden in form.hidden_fields %}
	    {{ hidden }}
	    {% endfor %}
	    {% endif %}
	    {{ field.errors.as_ul }}
	    {{ field }}
	  </td>
	  {% endfor %}
	</tr>
	{% endfor %}
      </table>
      <input type="submit" value="Submit" />
    </form>
  </body>
</html>
